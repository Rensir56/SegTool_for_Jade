# Redis配置文件 - 针对考古工具项目优化

# 基础配置
bind 0.0.0.0
port 6379
timeout 300
tcp-keepalive 300

# 内存配置
maxmemory 2gb
maxmemory-policy allkeys-lru  # 内存不足时清理最近最少使用的键

# 持久化配置
save 900 1     # 900秒内至少1个键变化时保存
save 300 10    # 300秒内至少10个键变化时保存
save 60 10000  # 60秒内至少10000个键变化时保存

# AOF持久化（推荐开启，确保数据安全）
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# 日志配置
loglevel notice
logfile "/var/log/redis/redis-server.log"

# 安全配置
# requirepass your_secure_password  # 生产环境请取消注释并设置强密码

# 性能优化
# SAM embedding缓存优化
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# 网络优化
tcp-backlog 511

# 内存使用报告
latency-monitor-threshold 100

# 键空间事件通知（用于缓存过期监控）
notify-keyspace-events Ex

# 数据库数量
databases 16

# 0: SAM缓存
# 1: YOLO缓存  
# 2: 用户会话
# 3: 任务队列（Phase 3使用） 